name: Backend Deployment

on:
    push:
        branches:
            - main
    pull_request:
        types: [opened, synchronize, reopened, closed]
        branches:
            - main

jobs:
    build_and_deploy_job:
        if: github.event_name == 'push' || (github.event_name == 'pull_request' && github.event.action != 'closed')
        runs-on: ubuntu-latest
        name: Build and Deploy Job
        steps:
            - name: Checkout repository
              uses: actions/checkout@v3 # Poprawiona wersja v3

            - name: Setup Node.js
              uses: actions/setup-node@v3 # Poprawiona wersja v3
              with:
                  node-version: "18"

            - name: Install dependencies
              run: |
                  cd backend
                  npm install

            - name: Build backend
              run: |
                  cd backend
                  npm run build

            - name: Deploy to Azure App Service
              uses: azure/webapps-deploy@v1 # Zmienione na poprawną wersję
              with:
                  app-name: "streetmeetingbackend"
                  slot-name: "production"
                  publish-profile: ${{ secrets.AZURE_PUBLISH_PROFILE }}
                  package: backend
